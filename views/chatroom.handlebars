{{> dashboard-header }}



 <!-- Toggle Chat Button -->
     <button id="toggleChat"
        class="ml-4 text-white px-4 py-2 border border-gray-300 hover:bg-gray-200 hover:text-gray-800 transition duration-300 ease-in-out">
        <span id="toggleIcon" class="mr-2">View Chat</span>
    </button>

<body class="bg-gray-100">
  
    <div class="flex gap-4 p-4">
        <!-- Chatroom Section -->
        <div id="chatSection" class="w-1/5 h-screen bg-gray-800 border border-gray-300 p-4" style="height: 80vh">
            <!-- Chatroom List -->
            <div id="chatroomList" class="overflow-y-auto">
                {{!-- dynamic chatroom list will appear here --}}
                {{#each chatrooms}}
                <div class="chatroom cursor-pointer text-white p-2 bg-gray-700 mb-2 rounded">
                    <a href="/chatroom/{{this.id}}" class="text-white">{{this.chatroom_name}}</a>
                </div>
                {{/each}}
            </div>
        </div>

        <!-- Main Content Section -->
        <div id="mainSection" class="flex-1 h-screen bg-gray-800 border border-gray-300 p-4" style="height: 80vh">
            <!-- Main Content Goes Here -->
            <div id="chatContent" class="hidden h-full overflow-y-auto bg-gray-900 p-4" >
                {{!-- chat messages will appear here --}}
                <div id="messages" class="mb-4">
                    {{!-- dynamic chat messages will appear here --}}
                </div>

                <!-- message Form -->
                <form id="chatForm">
                    <input id="messageInput" type="text" placeholder="Type a message..." class="w-full p-2 mb-2 bg-gray-800 text-white border border-gray-600 rounded" />
                    <button type="submit" class="w-full p-2 bg-blue-800 text-white border border-blue-800 rounded">Send</button>
                </form>
            </div>

            <!-- link to find your duo -->
            <a href="#" id="linkBox"
                class="text-white px-4 py-2 border border-gray-300 bg-gray-800 hover:bg-gray-200 hover:text-gray-800 transition duration-300 ease-in-out absolute bottom-4 right-8">
                <span id="linkText">Find your Duo</span>
            </a>
        </div>
    </div>


    <!-- SOCKET.IO SCRIPT -->
    <script src="/socket.io/socket.io.js"></script>

    <script>
        // JavaScript to toggle chatroom visibility
        const toggleChatButton = document.getElementById('toggleChat');
        const chatContent = document.getElementById('chatContent');
        const chatSection = document.getElementById('chatSection');
        const mainSection = document.getElementById('mainSection');

        // Hide chatroom content by default
        chatSection.classList.add('hidden');

        // Toggle button click event
        toggleChatButton.addEventListener('click', () => {
            chatContent.classList.toggle('hidden');

            if (chatContent.classList.contains('hidden')) {
                // If chat is hidden, expand main section to full width
                chatSection.classList.remove('w-1/5');
                chatSection.classList.add('hidden');
                mainSection.classList.remove('flex-1');
                mainSection.classList.add('w-full');
                toggleIcon.textContent = 'View Chat';
            } else {
                // If chat is shown, revert to original sizes
                chatSection.classList.add('w-1/5');
                chatSection.classList.remove('hidden');
                mainSection.classList.add('flex-1');
                mainSection.classList.remove('w-full');
                toggleIcon.textContent = 'Hide Chat';
            }
        });

        // socket.io client-side script
        const socket = io();

        // joinChatroom function
        const joinChatroom(chatroom_id) {
            socket.emit('join', chatroom_id); // emit join event
            linkBox.style.display = 'none'; // hide link box
            chatContent.classList.remove('hidden'); // show chat content
        };

        // sendMessage function
        const sendMessage(room_id, sender_id, message_text) {
            socket.emit('chatMessage', { room_id, sender_id, message_text }); // emit message event
        };

        // get the chatroom list
        const chatroomList = document.getElementById('chatroomList');

        // populate default chatroom list
        const chatroomsDefault = [
            { id: 1, name: 'New Releases' },
            { id: 2, name: 'General Game Reviews' },
            { id: 3, name: 'Easter Egg Finds' },
        ];

        // loop through chatroomsDefault array
        chatroomsDefault.forEach((chatroom) => {
            const chatroomElement = document.createElement('div'); // create a new div element
            // add classes and text content
            chatroomElement.classList.add('chatroom', 'cursor-pointer', 'text-white', 'p-2', 'bg-gray-700', 'mb-2', 'rounded');
            chatroomElement.textContent = chatroom.name; // set text content
            // add click event listener to join chatroom
            chatroomElement.addEventListener('click', () => {
                joinChatroom(chatroom.id);
                chatContent.classList.remove('hidden');
                chatSection.classList.remove('w-1/5');
                chatSection.classList.add('hidden');
                mainSection.classList.remove('flex-1');
                mainSection.classList.add('w-full');
                toggleIcon.textContent = 'Hide Chat';
            });
            // append chatroom element to chatroom list
            chatroomList.appendChild(chatroomElement);
        });

        // listen for incoming chatroom messages
        socket.on('chatMessage', (data) => {
            const { sender_id, message_text, message_timestamp } = data;
            const messageElement = document.createElement('div');
            messageElement.classList.add('text-white', 'p-2', 'bg-gray-600', 'mb-2', 'rounded');
            messageElement.textContent = `${message_timestamp} - ${sender_id}: ${message_text}`;
            document.getElementById('messages').appendChild(messageElement);
        });

        // handle form submission
        document.getElementById('chatForm').addEventListener('submit', (e) => {
            e.preventDefault();
            // get message input value
            const messageInput = document.getElementById('messageInput');
            const messageText = messageInput.value;
            // check if message is not empty
            if (messageText.trim()) {
                sendMessage(1, 1, messageText);
                messageInput.value = '';
            }
            // dynamic room_id and sender_id values
            // UNFINISHED
            const room_id = ;
            const sender_id = '';

            // send message
            sendMessage(room_id, sender_id, messageText);
            messageInput.value = '';
        });
    </script>

